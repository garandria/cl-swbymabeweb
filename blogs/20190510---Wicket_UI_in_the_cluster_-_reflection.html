<p>In the last blog post I've talked about the technicallies of running Wicket clustered.</p>
<p>But there are more things to consider.&nbsp;</p>
<p dir="auto">The session handling of server based web applications is usually done by the web application server&nbsp;which in the Java world runs on top of a Servlet container.<br />This might be Jetty, Tomcat or some comercial one.</p>
<p dir="auto">The Servlet specification contains the session and cookie handling. <br />Since Wicket runs on the application server, it doesn't itself has to deal with storing and loading sessions. This is all done by the application server.<br />Wicket just 'uses' the session that the application server provides.</p>
<p dir="auto">In a cluster environment it is also the responsibility of the application server to create an environment where it replicates the session.</p>
<p dir="auto">As outlined in the previous article it is possible to follow certain best practices to help Wicket keep the session small, like using LoadableDetachableModel's.</p>
<p dir="auto">But the application server relies on a certain level of reliability of session stickiness of the load-balancer.<br />Looking at the technology stack there are just too many drawbacks when we have to assume a none-stickiness, or when this doesn&rsquo;t work reliably.</p>
<p dir="auto">There usually are a few scenarios how the session replication can work.</p>
<p dir="auto">If the session is stored in a database that all cluster nodes can use at the same time it might be possible that the application works without LB session stickiness.<br />But this is quite a performance hit since there is usually a long way to the database and the session data has to be serialized and deserialized.<br />In this scenario you cannot really use the second-level cache of the application server because session data might differ slightly when switching from one cluster node to another in a rapid succession.</p>
<p dir="auto">It is also possible to store the session in memory using a technology like Hazelcast, <a class="link" href="https://ignite.apache.org/use-cases/caching/web-session-clustering.html" target="_blank">Apache Ignite</a> or something like that.<br />In this scenario the session is stored locally in a second-level cache and then replicated in the background to other cluster nodes.<br />However the session replication might not be immediate. Which means that a non-stickiness will not properly work here. Because the session might not have replicated when the LB switches nodes during a request which will lead to unexpected behavior or page load errors.</p>
<p dir="auto">&nbsp;</p>
<p dir="auto">So it is highly recommended to use the application servers second-level cache for performance reasons and use session stickiness of the load-balancer.<br />To avoid SSL offloading load-balancers usually also can be configured to use certain nodes on an IP address or region basis.</p>
<p dir="auto">For more info take a look here:&nbsp;<a class="link" href="https://ci.apache.org/projects/wicket/guide/8.x/single.html#_lost_in_redirection_with_apache_wicket" target="_blank">https://ci.apache.org/projects/wicket/guide/8.x/single.html#_lost_in_redirection_with_apache_wicket</a></p>
